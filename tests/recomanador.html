<!doctype html><html><head>
  <meta charset=utf8>
  <title>Recomanador</title>
  <style>
    @import url('https://fonts.googleapis.com/css?family=Roboto+Mono:400,700|Roboto:300,400,700');
    body {
      font-family: 'Roboto', verdana;
      color: #5C5C5C;
    }
    table{
      border-collapse:collapse;
    }
  </style>
  <!--gui decimal number formatter-->
  <script src="format.js"></script>
  <!--load backend-->
  <script src="../state-variables.js"></script>
  <script src="../primary-settler.js"></script>
  <script src="../activated-sludge.js"></script>
  <script src="../nitrification.js"></script>
  <script src="../denitrification.js"></script>
  <script src="../chemical-P-removal.js"></script>
  <script src="../tram.js"></script>
  <script src="../recomanador.js"></script>
</head>
<h2>Recomanador</h2>

<div>
  <table border=1 style=font-size:smaller>
    <tr><th colspan=5>Execució del model amb variació del següents paràmetres:
    <tr><th>Input                 <th>Unitat <th>Valors provats <th>Descripció
    <tr><td>Rs                    <td>d      <td>[6 - 40]       <td>Temps de residència
    <tr><td>RAS                   <td>ø      <td>[0.75 - 1.25]  <td>Ratio recirculació externa
    <tr><td>DO                    <td>mgO/L  <td>[1.00 - 2.50]  <td>Oxigen dissolt al reactor
    <tr><td>mass FeCl<sub>3</sub> <td>kg/d   <td>[500 - 600]    <td>Clorur fèrric afegit (eliminació fosfat)
    <tr><th>Output                <th>Unitat <th>Valor desitjat <th>Descripció
    <tr><td>FOt                   <td>kgO/d  <td>               <td>Demanda total d'oxigen
    <tr><td>TSS                   <td>kg/d   <td>               <td>Producció de fangs total
    <tr><td>NH<sub>4</sub>        <td>mg/L   <td>&lt;0.5        <td>Amoni al final del riu
    <tr><td>PO<sub>4</sub>        <td>mg/L   <td>&lt;0.5        <td>Fosfat al final del riu
  </table>
</div>

<button id=run style="margin:5px 0;font-size:18px">Generar combinacions</button>

<table id=combinacions border=1></table>

<!--recomanador-->
<script>
  document.querySelector('#run').addEventListener('click',function(){
    //taula
    let t = document.querySelector("#combinacions"); t.innerHTML="";

    //la variable combinacions ve definida 'recomanador.js' conté totes les combinacions sense filtrar
    //filtra les combinacinos que compleixen amb els limits
    let solucions = combinacions.filter(obj=>(obj.NH4>0 && obj.NH4<0.5 && obj.PO4>0 && obj.PO4<0.5)); 

    //dibuixa taula de solucions
    let newRow=t.insertRow(-1);
    newRow.insertCell(-1).outerHTML=`<th colspan=16>Veient ${solucions.length} solucions (NH<sub>4</sub><0.5 & PO<sub>4</sub><0.5) de ${combinacions.length} combinacions provades`;
    if(solucions.length==0)return;

    //escriu headers columnes
    newRow=t.insertRow(-1);Object.keys(solucions[0]).forEach(key=>{newRow.insertCell(-1).outerHTML="<th>"+key.prettifyUnit();});

    //itera solucions
    solucions.forEach((obj,i)=>{
      let newRow = t.insertRow(-1);
      newRow.setAttribute('combinacio',i);
      Object.entries(obj).forEach(([key,val])=>{
        newRow.insertCell(-1).outerHTML=`<td key=${key} value=${val}>${format(val)}`;
      });
    });
  });
</script>
